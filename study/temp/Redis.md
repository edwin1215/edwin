# Redis

#### 清理过期键策略

- 定时删除
  - 优点：对内存十分友好，可以保证过期键及时被清理，并释放占用内存
  - 缺点：对CPU最不友好，体现在两方面：
    - 在过期键比较多的情况下，删除过期键十分占用CPU资源，将CPU时间占用在删除与任务无关的过期键上，会影响服务器的响应时间和吞吐量
    - 需要对每一个过期键建立timer，以维护其过期时间。
- 惰性删除
  - 优点：对CPU是最友好的
  - 缺点：对内存最不友好，会造成内存泄漏
- 定期删除
  - 综合以上两点的优缺点

#### redis过期键删除策略

- 惰性删除
  - 所有的读写操作每次执行前都会调用**expireIfNeeded**函数判断键是否过期，过期则删除
- 定期删除
  - 通过**activeExpireCycle**函数依次遍历所有数据库的expire字典，每次随机取出一部分键，删除其中的过期键。一个周期结束后记录执行进度，下一次执行时接着上一次的进度进行处理。
  - 是在**serverCron**函数执行时调用的，serverCron函数每隔100ms执行一次。

#### AOF、RDB和复制功能对过期键的处理

- ###### RDB

  - ###### 生成RDB文件：

    在执行SAVE或BGSAVE命令时，会生成RDB文件，生成RDB时不会保存已经失效key

  - ###### 载入RDB文件：

    在启动Redis服务的时候，如果开启了RDB功能，服务器将对RDB文件进行载入

    - 服务器为主服务器时，载入RDB文件时，程序会对文件中保存的key进行检查，已过期的key不会被载入到数据库中
    - 服务器为从服务器时，载入RDN文件时，程序会载入所有的key，不论是否过期


- ###### AOF

  ​

- ###### 复制



#### 持久化方式

##### AOF

##### RDB